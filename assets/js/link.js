!function(r,i,a){"use strict";function o(t,e){var o=this;i&&i.template&&a&&(o.$el=t,o.options=e,o.$elements=o.$el.find(o.options.elements),o.length=o.$elements.find(o.options.item).length,o.$addbutton=o.$el.find(o.options.addbutton),o.$submitbox=o.$addbutton.parent(),o.$addbutton.on("click",r.proxy(o.add_block,o)),o.$elements.find(o.options.editbutton).on("click",r.proxy(o.edit_block,o)),o.$elements.find(o.options.removebutton).on("click",r.proxy(o.remove_block,o)),o.update_buttons())}o.prototype.$addbutton=null,o.prototype.$el=null,o.prototype.$elements=null,o.prototype.length=0,o.prototype.options=null,o.prototype.$submitbox=null,o.prototype.add_block=function(t){t.preventDefault();var e=this;e.length++;var o=i.template(e.options.source),n=r(o({id:e.length}));n.find(e.options.editbutton).on("click",r.proxy(e.edit_block,e)),n.find(e.options.removebutton).on("click",r.proxy(e.remove_block,e)),e.$elements.append(n),e.update_buttons()},o.prototype.edit_block=function(t){t.preventDefault();var e=this,o=r(t.target||t.currentTarget).closest(e.options.item),n=o.attr("data-u"),i=o.find("#"+n+"-url"),l=o.find("#"+n+"-label"),p=o.find("#"+n+"-target");a.open(n+"-url","",""),r("#wp-link-url").val(i.val()),r("#wp-link-text").val(l.val()),r("#wp-link-target").prop("checked","_blank"===p.val()),a.htmlUpdate=function(){e.update_inputs(o,r("#wp-link-url").val(),r("#wp-link-text").val(),r("#wp-link-target").prop("checked")?"_blank":"_self"),a.close()}},o.prototype.remove_block=function(t){t.preventDefault();var e=this,o=r(t.target||t.currentTarget).closest(e.options.item);o.css("background",e.options.color),o.animate({opacity:"0"},"slow",function(){o.remove(),e.update_buttons()})},o.prototype.update_buttons=function(){var t=this,e=t.$elements.find(t.options.item).length;1<=e&&!t.options.multiple&&t.$submitbox.hide(),e&&!t.options.multiple||t.$submitbox.show()},o.prototype.update_inputs=function(t,e,o,n){var i=this,l=t.attr("data-u");t.find("#"+l+"-url").val(e),t.find("#"+l+"-label").val(o),t.find("#"+l+"-target").val(n),t.find(i.options.linklabel).text(o),t.find(i.options.linkurl).attr("href",e),t.find(i.options.linkurl).attr("target","_blank"),t.find(i.options.linkurl).text(e)};var e={init:function(t){if(!this.length)return!1;var e={color:"#ffaaaa",elements:".listbox",item:"fieldset",multiple:!1,addbutton:".add-button",editbutton:".edit-button",removebutton:".remove-button",linkurl:".link-url",linklabel:".link-label",source:"template-id"};return this.each(function(){t&&r.extend(e,t),new o(r(this),e)})}};r.fn.dionysosLink=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(r.error("Method "+t+" does not exist on dionysosLink"),!1):e.init.apply(this,arguments)}}(window.jQuery,window.wp,window.wpLink);